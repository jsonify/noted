<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src {{cspSource}} 'unsafe-inline';">
    <title>Note Graph</title>
    <link rel="stylesheet" href="{{cssUri}}">
</head>
<body>
    <div id="container">
        <!-- Stats Panel -->
        <div id="stats-panel">
            <div class="stat-group">
                <div class="stat-item">
                    <span class="stat-value" id="noteCount">{{noteCount}}</span>
                    <span class="stat-label">Notes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="tagCount">{{tagCount}}</span>
                    <span class="stat-label">Tags</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="linkCount">{{linkCount}}</span>
                    <span class="stat-label">Links</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="orphanCount">{{orphanCount}}</span>
                    <span class="stat-label">Orphans</span>
                </div>
            </div>
            <div class="button-group">
                <button id="recenterBtn" class="icon-btn" title="Re-center and Fit All Nodes">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5h-13zM3 2h11v11H3V2zm5.5 2a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1 0-1h2v-2a.5.5 0 0 1 .5-.5z"/>
                    </svg>
                </button>
                <button id="refreshBtn" class="icon-btn" title="Refresh Graph Data">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M13.451 5.609l-.579-.939-1.068.812-.076.094c-.422.501-.827.908-1.216 1.218-.389.31-.835.602-1.338.876C8.682 7.916 8 8 7.166 8c-.889 0-1.653-.238-2.294-.714-.641-.477-1.098-1.128-1.372-1.954a4.21 4.21 0 01-.177-.765 2.22 2.22 0 00-.04-.224v-.019H3V3h2.5v2l-.724-.276c.018.12.045.246.081.379.105.39.274.744.506 1.062.232.318.548.583.947.793.4.21.87.316 1.411.316.623 0 1.091-.066 1.405-.197.314-.131.62-.325.916-.583.297-.258.553-.542.769-.853l.099-.141.081-.124a7.49 7.49 0 01-.591-.981 6.74 6.74 0 01-.472-1.156c-.188-.593-.282-1.228-.282-1.903h1.5c0 .551.071 1.037.213 1.46.142.423.335.805.579 1.145.244.34.534.637.87.89.336.254.714.457 1.136.609l.073.026.044-.08c.14-.244.306-.47.498-.677.192-.207.415-.386.669-.536.254-.15.545-.266.873-.349.328-.082.699-.124 1.113-.124v1.5c-.251 0-.467.024-.649.073a1.47 1.47 0 00-.484.217 1.56 1.56 0 00-.349.33 1.78 1.78 0 00-.224.404z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Filter Controls -->
        <div id="filter-controls">
            <div class="filter-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="showNotes" checked />
                    <span>Notes</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showTags" checked />
                    <span>Tags</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showPlaceholders" checked />
                    <span>Placeholders</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="showOrphans" checked />
                    <span>Orphans</span>
                </label>
            </div>

            <!-- Time-based Filter -->
            <div class="filter-section">
                <div class="filter-section-header">Time Filter</div>
                <div class="filter-group">
                    <label class="radio-label">
                        <input type="radio" name="timeMode" value="created" checked />
                        <span>Created</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="timeMode" value="modified" />
                        <span>Modified</span>
                    </label>
                </div>
                <div class="filter-group">
                    <select id="timeRangeSelect" class="time-select">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="7">Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="365">Last 365 Days</option>
                        <option value="custom">Custom Range...</option>
                    </select>
                </div>
                <div id="customDateRange" class="custom-date-range" style="display: none;">
                    <div class="date-input-group">
                        <label for="startDate">From:</label>
                        <input type="date" id="startDate" class="date-input" />
                    </div>
                    <div class="date-input-group">
                        <label for="endDate">To:</label>
                        <input type="date" id="endDate" class="date-input" />
                    </div>
                </div>
            </div>

            <button id="clearFiltersBtn" class="text-btn" title="Reset All Filters">
                Clear Filters
            </button>
        </div>

        <!-- Graph Container -->
        <div id="graph"></div>

        <!-- Legend -->
        <div id="legend">
            <div class="legend-title">Node Types</div>
            <div class="legend-item">
                <div class="legend-marker" style="background-color: var(--note-color, #69db7c);"></div>
                <span>Note</span>
            </div>
            <div class="legend-item">
                <div class="legend-marker" style="background-color: var(--tag-color, #ff922b);"></div>
                <span>Tag</span>
            </div>
            <div class="legend-item">
                <div class="legend-marker" style="background-color: var(--placeholder-color, #e599f7);"></div>
                <span>Placeholder</span>
            </div>
            <div class="legend-item">
                <div class="legend-marker" style="background-color: var(--orphan-color, #adb5bd);"></div>
                <span>Orphan</span>
            </div>
            <div class="legend-hint">
                ðŸ’¡ Click node to open<br>
                ðŸ’¡ Shift+Click to multi-select
            </div>
        </div>
    </div>

    <!-- Inject Libraries -->
    <script src="{{d3Uri}}"></script>
    <script src="{{forceGraphUri}}"></script>

    <!-- Inject Graph Data -->
    <script>
        window.graphData = {{graphDataJson}};
        window.graphConfig = {{graphConfigJson}};
        window.vscode = acquireVsCodeApi();
    </script>

    <!-- Main Graph Script -->
    <script src="{{scriptUri}}"></script>
</body>
</html>
