<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src {{cspSource}} 'unsafe-inline';">
    <title>Note Graph</title>
    <link rel="stylesheet" href="{{cssUri}}">
    <script src="{{visNetworkUri}}"></script>
</head>
<body>
    <div id="container">
        <div id="toolbar">
            <div id="stats">
                <div class="stat-item">
                    <span class="stat-label">Notes:</span>
                    <span id="noteCount">{{noteCount}}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Links:</span>
                    <span id="linkCount">{{linkCount}}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Orphans:</span>
                    <span id="orphanCount">{{orphanCount}}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Connections:</span>
                    <span id="avgConnections">{{avgConnections}}</span>
                </div>
            </div>

            <div id="controls">
                <input type="text" id="searchBox" placeholder="Search notes..." />

                <select id="layoutSelect">
                    <option value="force">Force-Directed</option>
                    <option value="hierarchical">Hierarchical</option>
                    <option value="circular">Circular</option>
                </select>

                <select id="filterSelect">
                    <option value="all">All Notes</option>
                    <option value="connected">Connected Only</option>
                    <option value="orphans">Orphans Only</option>
                </select>

                <button id="refreshBtn">Refresh</button>
                <button id="fitBtn">Fit View</button>
                <button id="customizeBtn">Customize</button>
            </div>
        </div>

        <div id="graph"></div>

        <div id="noLinksMessage" class="{{noLinksClass}}">
            <h3>No Links Found</h3>
            <p>Your notes are not connected yet. To create connections, add wiki-style links to your notes.</p>
            <p>Examples:</p>
            <ul style="text-align: left; display: inline-block;">
                <li><code>[[note-name]]</code> - Simple link</li>
                <li><code>[[2025-01-15]]</code> - Date-based link</li>
                <li><code>[[note-name|Custom Text]]</code> - Link with display text</li>
            </ul>
            <p>All {{totalNotes}} notes are currently shown as orphans. Click any node to open that note and start adding links!</p>
        </div>

        <div id="legend">
            <h3>Node Colors</h3>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #cccccc;"></div>
                <span class="legend-label">Orphan (no links)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #69db7c;"></div>
                <span class="legend-label">1-2 connections</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4dabf7;"></div>
                <span class="legend-label">3-5 connections</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffa500;"></div>
                <span class="legend-label">6-10 connections</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff6b6b;"></div>
                <span class="legend-label">10+ connections</span>
            </div>
            <div class="legend-divider"></div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e83e8c;"></div>
                <span class="legend-label">Links</span>
            </div>
            <div class="legend-hint">
                ðŸ’¡ Click a node to highlight its connections<br>
                ðŸ’¡ Click canvas to clear highlights
            </div>
        </div>
    </div>

    <div id="tooltip"></div>

    <div id="customizePanel" class="hidden">
        <div class="panel-header">
            <h2>Graph Customization</h2>
            <button id="closePanelBtn">âœ•</button>
        </div>
        <div class="panel-content">
            <div class="setting-section">
                <h3>Node Appearance</h3>

                <div class="setting-item">
                    <label for="nodeSize">Node Size</label>
                    <input type="range" id="nodeSize" min="5" max="50" value="20" />
                    <span id="nodeSizeValue">20</span>
                </div>

                <div class="setting-item">
                    <label for="nodeBorderWidth">Border Width</label>
                    <input type="range" id="nodeBorderWidth" min="1" max="6" value="2" />
                    <span id="nodeBorderWidthValue">2</span>
                </div>

                <div class="setting-item">
                    <label for="nodeShape">Node Shape</label>
                    <select id="nodeShape">
                        <option value="dot">Dot (Circle)</option>
                        <option value="diamond">Diamond</option>
                        <option value="square">Square</option>
                        <option value="triangle">Triangle</option>
                        <option value="star">Star</option>
                        <option value="hexagon">Hexagon</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="nodeShadow" checked />
                        Enable Shadows
                    </label>
                </div>
            </div>

            <div class="setting-section">
                <h3>Edge Appearance</h3>

                <div class="setting-item">
                    <label for="edgeWidth">Edge Width</label>
                    <input type="range" id="edgeWidth" min="1" max="8" value="2" />
                    <span id="edgeWidthValue">2</span>
                </div>

                <div class="setting-item">
                    <label for="edgeColor">Edge Color</label>
                    <input type="color" id="edgeColor" value="#e83e8c" />
                </div>

                <div class="setting-item">
                    <label for="edgeStyle">Edge Style</label>
                    <select id="edgeStyle">
                        <option value="continuous">Smooth Curve</option>
                        <option value="dynamic">Dynamic</option>
                        <option value="straight">Straight Line</option>
                        <option value="cubicBezier">Cubic Bezier</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="edgeArrows" checked />
                        Show Arrows
                    </label>
                </div>
            </div>

            <div class="setting-section">
                <h3>Physics & Animation</h3>

                <div class="setting-item">
                    <label for="springLength">Spring Length</label>
                    <input type="range" id="springLength" min="50" max="400" value="200" />
                    <span id="springLengthValue">200</span>
                </div>

                <div class="setting-item">
                    <label for="repulsion">Node Repulsion</label>
                    <input type="range" id="repulsion" min="10000" max="50000" value="30000" />
                    <span id="repulsionValue">30000</span>
                </div>

                <div class="setting-item">
                    <label for="gravity">Central Gravity</label>
                    <input type="range" id="gravity" min="0" max="100" value="30" step="5" />
                    <span id="gravityValue">0.30</span>
                </div>
            </div>

            <div class="setting-section">
                <h3>Custom Node Colors</h3>

                <div class="setting-item">
                    <label for="orphanColor">Orphan Nodes</label>
                    <input type="color" id="orphanColor" value="#cccccc" />
                </div>

                <div class="setting-item">
                    <label for="lowConnColor">Low Connections (1-2)</label>
                    <input type="color" id="lowConnColor" value="#69db7c" />
                </div>

                <div class="setting-item">
                    <label for="medConnColor">Medium Connections (3-5)</label>
                    <input type="color" id="medConnColor" value="#4dabf7" />
                </div>

                <div class="setting-item">
                    <label for="highConnColor">High Connections (6-10)</label>
                    <input type="color" id="highConnColor" value="#ffa500" />
                </div>

                <div class="setting-item">
                    <label for="veryHighConnColor">Very High Connections (10+)</label>
                    <input type="color" id="veryHighConnColor" value="#ff6b6b" />
                </div>
            </div>

            <div class="panel-footer">
                <button id="resetDefaultsBtn">Reset to Defaults</button>
                <button id="applySettingsBtn" class="primary">Apply</button>
            </div>
        </div>
    </div>

    <script>
        // Inject graph data
        window.graphData = {{graphDataJson}};
    </script>
    <script src="{{scriptUri}}"></script>
</body>
</html>
